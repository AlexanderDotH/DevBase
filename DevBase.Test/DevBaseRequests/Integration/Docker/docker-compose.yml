version: '3.8'

services:
  # Mock API server for testing HTTP scenarios
  mock-api:
    build:
      context: ./MockApi
      dockerfile: Dockerfile
    ports:
      - "5080:8080"
    environment:
      - ASPNETCORE_URLS=http://+:8080
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 5

  # HTTP Proxy with Basic Authentication (Tinyproxy)
  http-proxy:
    image: vimagick/tinyproxy:latest
    ports:
      - "8888:8888"
    volumes:
      - ./Proxies/tinyproxy.conf:/etc/tinyproxy/tinyproxy.conf:ro
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8888"]
      interval: 5s
      timeout: 3s
      retries: 5

  # SOCKS5 Proxy with Authentication (using microsocks)
  socks5-proxy:
    image: vimagick/microsocks:latest
    ports:
      - "1080:1080"
    command: ["-i", "0.0.0.0", "-p", "1080", "-u", "testuser", "-P", "testpass"]
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "1080"]
      interval: 5s
      timeout: 3s
      retries: 5

  # SOCKS5 Proxy without Authentication
  socks5-proxy-noauth:
    image: vimagick/microsocks:latest
    ports:
      - "1081:1080"
    command: ["-i", "0.0.0.0", "-p", "1080"]
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "1080"]
      interval: 5s
      timeout: 3s
      retries: 5

  # HTTP Proxy without Authentication (for comparison)
  http-proxy-noauth:
    image: vimagick/tinyproxy:latest
    ports:
      - "8889:8888"
    volumes:
      - ./Proxies/tinyproxy-noauth.conf:/etc/tinyproxy/tinyproxy.conf:ro
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "8888"]
      interval: 5s
      timeout: 3s
      retries: 5

networks:
  default:
    name: devbase-test-network
